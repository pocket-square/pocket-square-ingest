
Ошибки типовые и не очень / Хабрахабр
TM Feed
Хабрахабр
Geektimes
Тостер
Мой круг
Фрилансим
Спецпроекты:
Хабрахабр
Публикации
Хабы
Компании
Пользователи
Песочница
Войти
Регистрация
@anonymous1
          Пользователь
        
8,0
карма
0,0
рейтинг
Профиль
1
Публикации
3
Комментарии
0
Избранное
1
Подписчики
       13 мая 2015 в 23:43 
    
Разработка →
Ошибки типовые и не очень
из песочницы
Информационная безопасность*
История рассказывает о том, как ряд простых ошибок сложились в один ряд и обернулись ощутимыми неприятностями для одной компании. Впрочем, компания промышляла мошенничеством и спамом, так что, может быть, это и неплохо.
Все лица и события конечно вымышлены, однако автор предпочел остаться анонимом из Tor :) Главного героя будем называть «автор».
Не рассылайте спам. Особенно sms-спам
Был обычный день. Автор в очередной раз получил sms-сообщение от какого-то сервиса выдачи денег. Будем называть его РосКапитал. Неожиданно автор понял, что это его достало, и решил отплатить спамеру той же монетой. 

Автор зашел на сайт сервиса, нашел там форму обратной связи и решил обеспечить туда поток запросов обратной связи. Был написан скрипт, который регулярно отправлял запросы, подставляя случайные имена, фамилии и телефонные номера, а затем запущен в постоянную работу через большой пул прокси (так сложилось, что у автора был под рукой такой пул прокси).
Стоит отметить, что при изучении сайта автор понял, что РосКапитал является типичной финансовой пирамидой.
Отключайте вывод ошибок в публичной (продакшн) версии своего сервиса
Через какое-то время автор для разнообразия решил просмотреть логи работы своего скрипта. В логи попадали ответы сервера на отправленные запросы обратной связи. В логах автор заметил, что некоторое время сервер возвращал ошибку. Суть ошибки была в невозможности получить доступ к документу Google. К ошибке любезно прилагался стек вызовов, в котором был виден логин и пароль аккаунта Google. Очевидно, что РосКапитал просто записывал запросы обратной связи в документ Google, к которому у используемого аккаунта забрали доступ или что-то подобное.
По возможности используйте двухфакторную авторизацию для своих аккаунтов. Не используйте важные аккаунты для автоматизированного доступа к различным ресурсам
Используя эти логин и пароль (ну и конечно же Tor), автор вошел в этот аккаунт. На почте были в основном сообщения, связанные с работой сервиса – заказы рекламы, оплата сервера, сообщения от платежной системы. Сообщения от платежной системы заинтересовали автора больше всего.
Платежные системы должны обеспечивать полностью двухфакторную защиту платежей
На сайте платежной системы автор сделал запрос на восстановление пароля. На почту успешно пришли и новый пароль, и новый платежный пароль. То есть, если злоумышленник получает доступ к почте, то он получает оба пароля и никакой двухфакторности не остается.
После этого автор успешно обменял большую часть средств с аккаунта на биткоины.
Вскоре владелец аккаунта поменял пароль.
Вовремя устанавливайте пакеты обновлений и исправлений. Это же должны делать все ваши контрагенты
Дело происходило во время обнаружения уязвимости «Heartbleed» в OpenSSL. Автор уже закрыл эту уязвимость на серверах, за которые он отвечал, и решил поискать, кто ее еще не закрыл. На ум автору, конечно же, пришел тот самый сервис.
Уязвимость там не была закрыта.
Был написан скрипт, который регулярно дергал сервер РосКапитала и выуживал 64 КБ из его памяти, а затем запущен в постоянную работу (опять же через прокси).
Стоит привязывать сессию на сайте к IP (хотя с этим могут быть другие подводные камни)
Через какое-то время в логах появилась сессия администратора.
Используя эту сессию и выставив соответствующий useragent в браузере, автор свободно попал в админку. Там он создал «депозит» на большую сумму и сразу же вывел его в биткоины.
Вскоре админка стала возвращать код ошибки 403, видимо к ней закрыли доступ по IP.
Бывает, что VPN понижает безопасность (!)
Уязвимость Heartbleed на том сайте по-прежнему не была закрыта, и скрипт продолжал собирать данные из памяти сервера. В частности, был получен кусок конфига nginx.
В конфиге было видно, что доступ к админке ограничен подсетью IP-адресов. После тщательного поиска в сети, автор выяснил, что есть VPN-сервис, который использует несколько IP из этой подсети.
Автор приобрел доступ к этому VPN и… снова попал в админку и снова вывел некоторую сумму денег в биткоины.
После этого доступ к админке был ограничен каким-то одним конкретным IP, а вскоре была закрыта сама уязвимость Heartbleed.
О банальном: пишите безопасный код
Автор уже не мог остановиться и решил просто поискать уязвимости в сервисе.
В результате был найден URL-ресурс, который просто считывал и отдавал содержимое файла, имя которого было передано в запросе к ресурсу.
Уязвимость по сути была слепой, т.е. найти интересные файлы можно было только методом тыка.
Во FreeBSD есть особенность, которая потенциально снижает ее безопасность по сравнению с Linux (!)
Но на помощь пришла FreeBSD. Во FreeBSD можно прочитать каталог как файл. При этом отдается запись о каталоге из файловой системы – там видны все файлы и вложенные каталоги.
Так изучение структуры файлов стало намного интереснее. Однако автору не удавалось найти ничего вкусного. Загрузить свои файлы не представлялось возможным. Реквизиты доступа к базе были найдены, но подключиться к базе было невозможно. PHPMyAdmin был только на отдельном поддомене, который был запаролен.
Пароли открытым текстом – всегда зло
Однако в итоге на сервере был найден управляющий скрипт (шелл), пароль к которому был указан прямо в его коде открытым текстом.
Автор, используя этот шелл, тут же оставил свои закладки в разных местах кода сервиса. Утилита touch помогла сменить временные метки измененных файлов, чтобы по возможности затруднить обнаружение закладок.
Далее оставалось дело техники. Из базы были извлечены ключи доступа к API платежных систем, из которых затем были благополучно слиты все средства и переведены в биткоины.

После этого автор через API наблюдал, как все поступающие в платежные системы средства каждые несколько минут выводятся на другие кошельки. Очевидно, владельцы сервиса пытались спасти как можно больше средств. Вообще это была довольно популярная финансовая пирамида, и входящие переводы шли постоянно. Вскоре РосКапитал прекратил свою работу. В принципе это в любом случае было их целью, однако автор явно серьезно уменьшил объем их средств. Для понимания масштабов – объем похищенных средств составил порядка 140-150 BTC. Выяснить курс BTC на то время наверняка не составит труда у читателей.

С тех пор вымышленного автора этой вымышленной истории мучает вопрос: хорошо ли воровать у мошенников, особенно с учетом того, что мошенники в конечном итоге получили деньги от людей, которые виноваты только в том, что верят в сказки?
неожиданные проблемы, 
вымышленные истории
Реклама помогает поддерживать и развивать наши сервисыПодробнее
Реклама
Хабы
Разработка веб-сайтов
PHP
JavaScript
Разработка под Android
Программирование
Разработка мобильных приложений
Браузеры
Big Data
Open source
Node.JS
Все хабы
Реклама помогает поддерживать и развивать наши сервисыПодробнее
Реклама
↑
+21
↓
13,8k
Добавить в избранное
62
Выберите рекомендации для отправки автору:
Указан только блог
Орфографические ошибки
Пунктуационные ошибки
Отступы
Текст-простыня
Короткие предложения
Смайлики
Много форматирования
Картинки
Ссылки
Отправить
@anonymous1
карма
8,0
рейтинг
0,0
Похожие публикации
+21
История языков программирования: SQL- стандартизация длиною в жизнь
11,5k
64
7
+18
История одной фичи или зачем хакатон программисту
11,6k
40
26
+25
История языков программирования: как Fortran позволил пользователям общаться с ЭВМ на «ты»
9,6k
51
31
Самое читаемое
Разработка
Сейчас
Сутки
Неделя
Месяц
+9
What the flask?
2,1k
10
2
+6
Пора играть честно, Microsoft
8,7k
14
240
+9
Книга «В работу с головой. Паттерны успеха от IT-специалиста»
7,9k
51
10
+3
Самые популярные слова в двух терабайтах кода
453
4
12
+19
Async/await это шаг назад для JavaScript'a?
10,5k
78
69
+27
Правильный путь становления безопасника: от ламера до практического эксплойтинга
13,6k
197
16
+19
Async/await это шаг назад для JavaScript'a?
10,5k
78
69
+6
Пора играть честно, Microsoft
8,7k
14
240
+9
Книга «В работу с головой. Паттерны успеха от IT-специалиста»
7,9k
51
10
+26
Экзамен для будущих «русских хакеров» в Московском Политехе
17,8k
140
32
+56
Старикам здесь вполне ещё место: забытые ИT-технологии в строю
34,1k
78
136
+135
Что если в играх использовать видеокарточку для физики, а не для графики
27k
115
179
+36
Один из простых способов улучшить свои навыки программирования — читать чужой код
24,9k
247
33
+34
Пользователи Windows получили возможность работать с openSUSE (и Arch Linux)
23,6k
110
71
+54
Я работаю в ТехЦентре Дойче Банка
22,1k
47
67
+47
Самые востребованные языки программирования 2016
63,6k
112
152
+96
Писать веб-сайты на ассемблере полезно и приятно
58,4k
268
428
+107
Как проектируют ненастоящие программисты
54,4k
158
257
+75
Уязвимость Viber, позволяющая прослушивать чужой разговор
49,5k
58
33
+92
Почему Hackintosh уже актуален. Развенчание мифов
46,6k
485
430
      Комментарии (7)
      
    
BatR00t
            14 мая 2015 в 16:58
          
+2
↑
↓
          То, что перевёл Вымышленный Автор — это ещё не все потери. Нужно еще прибавить расходы на наем прямых рук для закрытия дыр.
        
spiritms
            14 мая 2015 в 18:25
          
0
↑
↓
          Красиво, конечно. Но чую, что Вымышленный Автор ранее работал в РосКапитал и только поэтому смог бы это провернуть.
        
anonymous1
            14 мая 2015 в 20:47
          
0
↑
↓
          Нет, он никогда не работал ни с ними, ни с другими подобными «организациями».
А почему вы решили, что работал?
        
Zifix
            14 мая 2015 в 18:40
          
+2
↑
↓
С тех пор вымышленного автора этой вымышленной истории мучае вопрос: хорошо ли воровать у мошенниковИдти на сделку с совестью — идея плохая, так что можно потратить на благотворительность, это точно будет хорошо)
        
prolis
            14 мая 2015 в 19:00
          
0
↑
↓
автор свободно попал в админку. Там он создал «депозит» на большую сумму и сразу же вывел его в биткоины.
 — т.е. еще до прямого доступа к бд нашлась веб-админка к учетной системе с возможностью управления остатками и реквизитами. Но зачем она была создана с таким функционалом?
        
anonymous1
            14 мая 2015 в 20:50
          
0
↑
↓
          На самом деле все немного сложнее — в админке можно было регулировать сроки и проценты депозитов. Автор создал себе мгновенный депозит под миллионы процентов.
        
anonymous1
            14 мая 2015 в 20:52
          
0
↑
↓
          Ну и еще вывод требовал одобрения администратора. Автор соответственно мог сам себе его одобрять.
        
Только зарегистрированные пользователи могут оставлять комментарии. Войдите, пожалуйста.
Пометьте топик понятными вам метками, если хотите
Метки лучше разделять запятой. Например: общение, социальные сети, myspace.com, подростки, мердок
 или закрыть
Что обсуждают
Сейчас
Вчера
Неделя
Месяц
Это не ransomware, но в любом случае может «захватить» Ваш сервер  9
Самые популярные слова в двух терабайтах кода  12
Автоматическая визуализации python-кода с использованием блок-схем  58
Семь отличных ускорителей сайтов для Linux и Unix  10
Викимарт и “теория бОльшего дурака” в электронной коммерции  11
Пора играть честно, Microsoft  240
Async/await это шаг назад для JavaScript'a?  69
Будущее мобайла — не приложения, а браузеры  40
Выпуск фреймворка Qt 5.8  40
Краткий обзор нововведений в Laravel 5.4  35
Пора играть честно, Microsoft  240
Почему в России много идей, но мало стартапов  212
Что если в играх использовать видеокарточку для физики, а не для графики  179
Linux-2017: самые перспективные дистрибутивы  161
Старикам здесь вполне ещё место: забытые ИT-технологии в строю  136
Обратная сторона Agile  575
IDEA пора закапывать?  504
Почему Hackintosh уже актуален. Развенчание мифов  430
Писать веб-сайты на ассемблере полезно и приятно  428
Обещания Google начали сбываться — теперь сайты https помечаются как надёжные  321
Интересные публикации
Хабрахабр
Гиктаймс
Национальные домены vs один общий домен: кейс 841% роста от международного бренда  4
What the flask?  2
Как изучать английскую грамматику БЕЗ упражнений. Творческий подход — внедрение юнитов в главы своей книги  17
3D-моделирование и гибкая эндоскопия  4
Как рождались IT-династии в Беларуси  0
Краткий обзор нововведений в Laravel 5.4  35
Южная Корея разрабатывает свой Hyperloop  26
Как получаются дети [18+]  60
Пользовательские исследования в играх  2
Китай объявил о 14-месячной облаве на VPN, используемых для обхода национального файервола  55
Реклама помогает поддерживать и развивать наши сервисыПодробнее
Реклама
Войти
Регистрация
Разделы
Публикации
Хабы
Компании
Пользователи
Q&A
Песочница
Инфо
О сайте
Правила
Помощь
Соглашение
Услуги
Реклама
Тарифы
Контент
Семинары
Разное
iOS приложение
Android приложение
Помощь стартапам
© TM
Служба поддержки
Мобильная версия
